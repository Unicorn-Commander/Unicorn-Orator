<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Unicorn Orator - Professional AI Voice Synthesis</title>
    <link rel="icon" type="image/png" href="/static/Unicorn_Orator.png">
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="/static/voice-data.js"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    animation: {
                        'gradient': 'gradient 3s ease infinite',
                        'pulse-slow': 'pulse 3s ease-in-out infinite',
                    },
                    keyframes: {
                        gradient: {
                            '0%': { 'background-position': '0% 50%' },
                            '50%': { 'background-position': '100% 50%' },
                            '100%': { 'background-position': '0% 50%' }
                        }
                    }
                }
            }
        }
    </script>
    <style>
        /* Theme Variables */
        :root {
            --theme: 'magic';
        }
        
        /* Professional Light Theme */
        body.theme-light {
            --bg-primary: #ffffff;
            --bg-secondary: #f8f9fa;
            --text-primary: #212529;
            --text-secondary: #6c757d;
            --border-color: #dee2e6;
            --accent-primary: #0066cc;
            --accent-secondary: #0052a3;
            --input-bg: #ffffff;
            --input-border: #ced4da;
            --input-focus: #0066cc;
            --card-bg: #ffffff;
            --card-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        /* Professional Dark Theme */
        body.theme-dark {
            --bg-primary: #1a1d21;
            --bg-secondary: #22262b;
            --text-primary: #e9ecef;
            --text-secondary: #adb5bd;
            --border-color: #343a40;
            --accent-primary: #0d6efd;
            --accent-secondary: #0a58ca;
            --input-bg: #2b2f35;
            --input-border: #495057;
            --input-focus: #0d6efd;
            --card-bg: #22262b;
            --card-shadow: 0 2px 4px rgba(0,0,0,0.3);
        }
        
        /* Professional theme styles */
        body.theme-light, body.theme-dark {
            background-color: var(--bg-primary);
            color: var(--text-primary);
        }
        
        body.theme-light .card, body.theme-dark .card {
            background-color: var(--card-bg);
            border: 1px solid var(--border-color);
            box-shadow: var(--card-shadow);
        }
        
        body.theme-light .input-field, body.theme-dark .input-field {
            background-color: var(--input-bg);
            border-color: var(--input-border);
            color: var(--text-primary);
        }
        
        body.theme-light .input-field:focus, body.theme-dark .input-field:focus {
            border-color: var(--input-focus);
            box-shadow: 0 0 0 3px rgba(13, 110, 253, 0.25);
        }
        
        /* Improved Magic Unicorn theme text boxes */
        body.theme-magic .glass-input {
            background: rgba(255, 255, 255, 0.08);
            border: 1px solid rgba(255, 255, 255, 0.15);
            backdrop-filter: blur(12px);
            transition: all 0.3s ease;
        }
        
        body.theme-magic .glass-input:hover {
            background: rgba(255, 255, 255, 0.12);
            border-color: rgba(255, 255, 255, 0.25);
        }
        
        body.theme-magic .glass-input:focus {
            background: rgba(255, 255, 255, 0.15);
            border-color: rgba(147, 51, 234, 0.5);
            box-shadow: 0 0 0 3px rgba(147, 51, 234, 0.2), 0 0 20px rgba(147, 51, 234, 0.1);
        }
        .gradient-text {
            background: linear-gradient(-45deg, #6366f1, #8b5cf6, #ec4899, #3b82f6);
            background-size: 200% 200%;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            animation: gradient 3s ease infinite;
        }
        
        .glass-effect {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        .loading-dots::after {
            content: '...';
            animation: dots 1.5s steps(4, end) infinite;
        }
        
        @keyframes dots {
            0%, 20% { color: rgba(255, 255, 255, 0); text-shadow: .25em 0 0 rgba(255, 255, 255, 0), .5em 0 0 rgba(255, 255, 255, 0); }
            40% { color: white; text-shadow: .25em 0 0 rgba(255, 255, 255, 0), .5em 0 0 rgba(255, 255, 255, 0); }
            60% { text-shadow: .25em 0 0 white, .5em 0 0 rgba(255, 255, 255, 0); }
            80%, 100% { text-shadow: .25em 0 0 white, .5em 0 0 white; }
        }
        
        .tooltip {
            position: relative;
            display: inline-block;
            cursor: help;
        }
        
        .tooltip:hover::after {
            content: attr(title);
            position: absolute;
            bottom: 125%;
            left: 50%;
            transform: translateX(-50%);
            background-color: rgba(0, 0, 0, 0.9);
            color: white;
            padding: 8px 12px;
            border-radius: 6px;
            white-space: nowrap;
            font-size: 12px;
            z-index: 10;
            max-width: 250px;
            white-space: normal;
        }
        
        .tooltip:hover::before {
            content: '';
            position: absolute;
            bottom: 100%;
            left: 50%;
            transform: translateX(-50%);
            border: 6px solid transparent;
            border-top-color: rgba(0, 0, 0, 0.9);
            z-index: 10;
        }
    </style>
</head>
<body class="min-h-screen theme-magic bg-gradient-to-br from-purple-900 via-blue-900 to-indigo-900 text-white transition-all duration-300">
    <!-- Theme Switcher -->
    <div class="fixed top-4 right-4 z-50">
        <div class="flex items-center gap-2 glass-effect rounded-full p-2">
            <button onclick="setTheme('light')" class="theme-btn p-2 rounded-full hover:bg-white/20 transition-colors" title="Light Theme">
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z"/>
                </svg>
            </button>
            <button onclick="setTheme('dark')" class="theme-btn p-2 rounded-full hover:bg-white/20 transition-colors" title="Dark Theme">
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z"/>
                </svg>
            </button>
            <button onclick="setTheme('magic')" class="theme-btn p-2 rounded-full hover:bg-white/20 transition-colors" title="Magic Unicorn Theme">
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 3v4M3 5h4M6 17v4m-2-2h4m5-16l2.286 6.857L21 12l-5.714 2.143L13 21l-2.286-6.857L5 12l5.714-2.143L13 3z"/>
                </svg>
            </button>
        </div>
    </div>
    
    <div class="container mx-auto px-4 py-8">
        <!-- Header -->
        <div class="text-center mb-12">
            <div class="flex items-center justify-center gap-4 mb-6">
                <img src="/static/Unicorn_Orator.png" alt="Unicorn Orator Logo" class="h-32 w-auto drop-shadow-2xl animate-pulse-slow">
            </div>
            <h1 class="text-5xl font-bold gradient-text mb-4">Unicorn Orator</h1>
            <p class="text-xl text-purple-200 mb-2">Professional AI Voice Synthesis Platform</p>
            <p class="text-purple-300 text-sm">Powered by Magic Unicorn Technology & Kokoro AI</p>
        </div>

        <!-- Main Interface -->
        <div class="max-w-4xl mx-auto">
            <!-- Text Input Section -->
            <div class="glass-effect rounded-2xl p-8 mb-8">
                <h2 class="text-2xl font-semibold mb-6 flex items-center gap-3">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"/>
                    </svg>
                    Enter Text to Synthesize
                </h2>
                
                <textarea 
                    id="textInput"
                    class="w-full h-32 p-4 glass-input input-field rounded-xl text-white placeholder-purple-300 resize-none focus:outline-none transition-all duration-200"
                    placeholder="Enter the text you want to convert to speech..."
                    maxlength="1000"
                ></textarea>
                
                <div class="flex justify-between items-center mt-4 text-sm text-purple-300">
                    <span id="charCount">0 / 1000 characters</span>
                    <div class="flex gap-4">
                        <button 
                            id="clearBtn"
                            class="px-3 py-1 bg-red-500/20 hover:bg-red-500/30 rounded-lg transition-colors duration-200"
                        >
                            Clear
                        </button>
                        <button 
                            id="sampleBtn"
                            class="px-3 py-1 bg-blue-500/20 hover:bg-blue-500/30 rounded-lg transition-colors duration-200"
                        >
                            Load Sample
                        </button>
                    </div>
                </div>
            </div>

            <!-- Controls Section -->
            <div class="grid md:grid-cols-2 gap-6 mb-8">
                <!-- Voice Selection -->
                <div class="glass-effect rounded-xl p-6">
                    <h3 class="text-lg font-semibold mb-4 flex items-center gap-2">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 11a7 7 0 01-7 7m0 0a7 7 0 01-7-7m7 7v4m0 0H8m4 0h4m-4-8a3 3 0 01-3-3V5a3 3 0 116 0v6a3 3 0 01-3 3z"/>
                        </svg>
                        Voice Selection
                        <span class="text-xs bg-purple-500/20 px-2 py-1 rounded-full">50+ Voices</span>
                    </h3>
                    <select 
                        id="voiceSelect"
                        class="w-full p-3 glass-input input-field rounded-lg text-white focus:outline-none transition-all duration-200"
                    >
                        <option value="af">Loading voices...</option>
                    </select>
                    <div id="voiceInfo" class="mt-3 p-3 bg-white/5 rounded-lg hidden">
                        <div class="flex items-center justify-between mb-1">
                            <span id="voiceQuality" class="text-yellow-400"></span>
                            <span id="voiceAccent" class="text-xs text-purple-300"></span>
                        </div>
                        <p id="voiceDescription" class="text-sm text-purple-300"></p>
                    </div>
                </div>

                <!-- Speed Control -->
                <div class="glass-effect rounded-xl p-6">
                    <h3 class="text-lg font-semibold mb-4 flex items-center gap-2">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"/>
                        </svg>
                        Speech Speed
                    </h3>
                    <div class="space-y-3">
                        <input 
                            type="range" 
                            id="speedSlider"
                            min="0.5" 
                            max="2.0" 
                            step="0.1" 
                            value="1.0"
                            class="w-full h-2 bg-white/20 rounded-lg appearance-none cursor-pointer slider"
                        >
                        <div class="flex justify-between text-sm text-purple-300">
                            <span>0.5x (Slow)</span>
                            <span id="speedValue">1.0x (Normal)</span>
                            <span>2.0x (Fast)</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Advanced Settings -->
            <div class="glass-effect rounded-xl p-6 mb-8">
                <h3 class="text-lg font-semibold mb-4 flex items-center gap-2 cursor-pointer" onclick="toggleSettings()">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6V4m0 2a2 2 0 100 4m0-4a2 2 0 110 4m-6 8a2 2 0 100-4m0 4a2 2 0 110-4m0 4v2m0-6V4m6 6v10m6-2a2 2 0 100-4m0 4a2 2 0 110-4m0 4v2m0-6V4"/>
                    </svg>
                    Advanced Settings
                    <span id="settingsToggle" class="ml-auto text-sm">▼</span>
                </h3>
                <div id="settingsPanel" class="hidden space-y-4">
                    <!-- Sample Rate -->
                    <div>
                        <label class="block text-sm font-medium mb-2 flex items-center gap-2">
                            Sample Rate
                            <span class="tooltip" title="Audio quality - higher rates provide better quality but larger files">
                                <svg class="w-4 h-4 text-purple-300" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/>
                                </svg>
                            </span>
                        </label>
                        <select id="sampleRate" class="w-full p-2 glass-input input-field rounded-lg text-white">
                            <option value="16000">16 kHz (Compact)</option>
                            <option value="24000" selected>24 kHz (Standard)</option>
                            <option value="48000">48 kHz (High Quality)</option>
                        </select>
                    </div>
                    
                    <!-- Audio Format -->
                    <div>
                        <label class="block text-sm font-medium mb-2 flex items-center gap-2">
                            Audio Format
                            <span class="tooltip" title="Output format - WAV is uncompressed, MP3 is compressed">
                                <svg class="w-4 h-4 text-purple-300" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/>
                                </svg>
                            </span>
                        </label>
                        <select id="audioFormat" class="w-full p-2 glass-input input-field rounded-lg text-white">
                            <option value="wav" selected>WAV (Uncompressed)</option>
                            <option value="mp3" disabled>MP3 (Coming Soon)</option>
                        </select>
                    </div>
                    
                    <!-- Emotion Control -->
                    <div>
                        <label class="block text-sm font-medium mb-2 flex items-center gap-2">
                            Emotion Intensity
                            <span class="tooltip" title="Controls emotional expression in speech - higher values make speech more expressive">
                                <svg class="w-4 h-4 text-purple-300" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/>
                                </svg>
                            </span>
                        </label>
                        <input type="range" id="emotionSlider" min="0" max="2" step="0.1" value="1" class="w-full h-2 bg-white/20 rounded-lg">
                        <div class="flex justify-between text-xs text-purple-300 mt-1">
                            <span>Neutral</span>
                            <span id="emotionValue">Normal</span>
                            <span>Expressive</span>
                        </div>
                    </div>
                    
                    <!-- Pitch Control -->
                    <div>
                        <label class="block text-sm font-medium mb-2 flex items-center gap-2">
                            Pitch Adjustment
                            <span class="tooltip" title="Adjusts the pitch of the voice - negative values lower pitch, positive values raise it">
                                <svg class="w-4 h-4 text-purple-300" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/>
                                </svg>
                            </span>
                        </label>
                        <input type="range" id="pitchSlider" min="-5" max="5" step="0.5" value="0" class="w-full h-2 bg-white/20 rounded-lg">
                        <div class="flex justify-between text-xs text-purple-300 mt-1">
                            <span>-5 st</span>
                            <span id="pitchValue">0 st</span>
                            <span>+5 st</span>
                        </div>
                    </div>
                    
                    <!-- Processing Backend -->
                    <div>
                        <label class="block text-sm font-medium mb-2 flex items-center gap-2">
                            Processing Backend
                            <span class="tooltip" title="Hardware acceleration backend - CPU is most compatible">
                                <svg class="w-4 h-4 text-purple-300" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/>
                                </svg>
                            </span>
                        </label>
                        <select id="backend" class="w-full p-2 glass-input input-field rounded-lg text-white" disabled>
                            <option value="cpu" selected>CPU (ONNX Runtime)</option>
                            <option value="openvino">Intel iGPU (OpenVINO)</option>
                        </select>
                        <p class="text-xs text-purple-300 mt-1">Currently using CPU backend</p>
                    </div>
                </div>
            </div>

            <!-- Generate Button -->
            <div class="text-center mb-8">
                <button 
                    id="generateBtn"
                    class="px-12 py-4 bg-gradient-to-r from-purple-600 to-pink-600 hover:from-purple-700 hover:to-pink-700 rounded-xl font-semibold text-lg transition-all duration-200 transform hover:scale-105 disabled:opacity-50 disabled:cursor-not-allowed disabled:hover:scale-100"
                >
                    <span id="generateText">
                        <svg class="w-6 h-6 inline mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15.536 8.464a5 5 0 010 7.072m2.828-9.9a9 9 0 010 14.142M5.686 15.536a5 5 0 010-7.072m-2.828-9.9a9 9 0 000 14.142"/>
                        </svg>
                        Generate Speech
                    </span>
                </button>
            </div>

            <!-- Audio Player Section -->
            <div id="audioSection" class="glass-effect rounded-xl p-6 hidden">
                <h3 class="text-lg font-semibold mb-4 flex items-center gap-2">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19V6l12-3v13M9 19c0 1.105-1.343 2-3 2s-3-.895-3-2 1.343-2 3-2 3 .895 3 2zm12-3c0 1.105-1.343 2-3 2s-3-.895-3-2 1.343-2 3-2 3 .895 3 2zM9 10l12-3"/>
                    </svg>
                    Generated Audio
                </h3>
                
                <audio 
                    id="audioPlayer" 
                    controls 
                    class="w-full mb-4"
                    style="filter: hue-rotate(280deg) saturate(1.5);"
                >
                    Your browser does not support the audio element.
                </audio>
                
                <div class="flex gap-3">
                    <button 
                        id="downloadBtn"
                        class="px-4 py-2 bg-green-500/20 hover:bg-green-500/30 rounded-lg transition-colors duration-200 flex items-center gap-2"
                    >
                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/>
                        </svg>
                        Download
                    </button>
                    <button 
                        id="shareBtn"
                        class="px-4 py-2 bg-blue-500/20 hover:bg-blue-500/30 rounded-lg transition-colors duration-200 flex items-center gap-2"
                    >
                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8.684 13.342C8.886 12.938 9 12.482 9 12c0-.482-.114-.938-.316-1.342m0 2.684a3 3 0 110-2.684m0 2.684l6.632 3.316m-6.632-6l6.632-3.316m0 0a3 3 0 105.367-2.684 3 3 0 00-5.367 2.684zm0 9.316a3 3 0 105.367 2.684 3 3 0 00-5.367-2.684z"/>
                        </svg>
                        Share URL
                    </button>
                </div>
            </div>

            <!-- Status/Error Messages -->
            <div id="statusMessage" class="mt-6 p-4 rounded-lg hidden"></div>
        </div>

        <!-- Footer -->
        <footer class="text-center mt-16 pt-8 border-t border-white/10">
            <div class="flex items-center justify-center gap-2 text-purple-300 mb-2">
                <div class="w-6 h-6 rounded-full bg-gradient-to-r from-purple-400 to-pink-400"></div>
                <span>Magic Unicorn Unconventional Technology & Stuff Inc</span>
            </div>
            <p class="text-sm text-purple-400">Unicorn Orator v1.0 • UC-1 Pro AI Infrastructure</p>
        </footer>
    </div>

    <script>
        // DOM Elements
        const textInput = document.getElementById('textInput');
        const charCount = document.getElementById('charCount');
        const clearBtn = document.getElementById('clearBtn');
        const sampleBtn = document.getElementById('sampleBtn');
        const voiceSelect = document.getElementById('voiceSelect');
        const speedSlider = document.getElementById('speedSlider');
        const speedValue = document.getElementById('speedValue');
        const generateBtn = document.getElementById('generateBtn');
        const generateText = document.getElementById('generateText');
        const audioSection = document.getElementById('audioSection');
        const audioPlayer = document.getElementById('audioPlayer');
        const downloadBtn = document.getElementById('downloadBtn');
        const shareBtn = document.getElementById('shareBtn');
        const statusMessage = document.getElementById('statusMessage');
        const emotionSlider = document.getElementById('emotionSlider');
        const emotionValue = document.getElementById('emotionValue');
        const pitchSlider = document.getElementById('pitchSlider');
        const pitchValue = document.getElementById('pitchValue');

        let currentAudioBlob = null;

        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            loadVoices();
            updateCharCount();
            // Load saved theme or default to magic
            const savedTheme = localStorage.getItem('unicorn-orator-theme') || 'magic';
            setTheme(savedTheme);
        });

        // Event Listeners
        textInput.addEventListener('input', updateCharCount);
        clearBtn.addEventListener('click', clearText);
        sampleBtn.addEventListener('click', loadSample);
        speedSlider.addEventListener('input', updateSpeedValue);
        generateBtn.addEventListener('click', generateSpeech);
        downloadBtn.addEventListener('click', downloadAudio);
        shareBtn.addEventListener('click', shareAudio);
        voiceSelect.addEventListener('change', updateVoiceInfo);
        emotionSlider.addEventListener('input', updateEmotionValue);
        pitchSlider.addEventListener('input', updatePitchValue);

        // Functions
        function updateCharCount() {
            const count = textInput.value.length;
            charCount.textContent = `${count} / 1000 characters`;
            charCount.className = count > 900 ? 'text-red-300' : 'text-purple-300';
        }

        function clearText() {
            textInput.value = '';
            updateCharCount();
            hideAudio();
        }

        function loadSample() {
            textInput.value = "Welcome to Unicorn Commander Pro! This is a demonstration of our high-quality text-to-speech synthesis powered by Kokoro TTS and Magic Unicorn technology.";
            updateCharCount();
        }

        function updateSpeedValue() {
            const speed = parseFloat(speedSlider.value);
            speedValue.textContent = `${speed}x`;
            if (speed < 0.8) {
                speedValue.textContent += ' (Slow)';
            } else if (speed > 1.2) {
                speedValue.textContent += ' (Fast)';
            } else {
                speedValue.textContent += ' (Normal)';
            }
        }

        async function loadVoices() {
            try {
                const response = await fetch('/voices');
                const data = await response.json();
                
                voiceSelect.innerHTML = '';
                
                // Group voices by category
                const groups = groupVoices();
                
                Object.entries(groups).forEach(([category, voices]) => {
                    if (voices.length === 0) return;
                    
                    const optgroup = document.createElement('optgroup');
                    optgroup.label = category;
                    
                    voices.forEach(voice => {
                        const option = document.createElement('option');
                        option.value = voice.id;
                        option.textContent = `${voice.name} ${getQualityStars(voice.quality)}`;
                        optgroup.appendChild(option);
                    });
                    
                    voiceSelect.appendChild(optgroup);
                });
                
                // Select default voice and show its info
                voiceSelect.value = 'af_heart';
                updateVoiceInfo();
                
            } catch (error) {
                console.error('Failed to load voices:', error);
                showStatus('Failed to load available voices', 'error');
            }
        }
        
        function updateVoiceInfo() {
            const selectedVoice = voiceSelect.value;
            const info = voiceData[selectedVoice];
            
            if (info) {
                document.getElementById('voiceInfo').classList.remove('hidden');
                document.getElementById('voiceQuality').textContent = getQualityStars(info.quality);
                document.getElementById('voiceAccent').textContent = `${info.accent} ${info.gender}`;
                document.getElementById('voiceDescription').textContent = info.description;
            } else {
                document.getElementById('voiceInfo').classList.add('hidden');
            }
        }

        async function generateSpeech() {
            const text = textInput.value.trim();
            if (!text) {
                showStatus('Please enter some text to synthesize', 'error');
                return;
            }

            if (text.length > 1000) {
                showStatus('Text is too long (maximum 1000 characters)', 'error');
                return;
            }

            setLoading(true);
            hideStatus();

            try {
                const response = await fetch('/v1/audio/speech', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        text: text,
                        voice: voiceSelect.value,
                        speed: parseFloat(speedSlider.value)
                    })
                });

                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }

                const audioBlob = await response.blob();
                currentAudioBlob = audioBlob;
                
                const audioUrl = URL.createObjectURL(audioBlob);
                audioPlayer.src = audioUrl;
                
                showAudio();
                showStatus('Speech generated successfully!', 'success');
                
            } catch (error) {
                console.error('Error generating speech:', error);
                showStatus('Failed to generate speech. Please check your connection and try again.', 'error');
            } finally {
                setLoading(false);
            }
        }

        function setLoading(loading) {
            generateBtn.disabled = loading;
            if (loading) {
                generateText.innerHTML = `
                    <svg class="w-6 h-6 inline mr-2 animate-spin" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"/>
                    </svg>
                    <span class="loading-dots">Generating</span>
                `;
            } else {
                generateText.innerHTML = `
                    <svg class="w-6 h-6 inline mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15.536 8.464a5 5 0 010 7.072m2.828-9.9a9 9 0 010 14.142M5.686 15.536a5 5 0 010-7.072m-2.828-9.9a9 9 0 000 14.142"/>
                    </svg>
                    Generate Speech
                `;
            }
        }

        function showAudio() {
            audioSection.classList.remove('hidden');
            audioSection.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
        }

        function hideAudio() {
            audioSection.classList.add('hidden');
            if (audioPlayer.src) {
                URL.revokeObjectURL(audioPlayer.src);
                audioPlayer.src = '';
            }
            currentAudioBlob = null;
        }

        function downloadAudio() {
            if (!currentAudioBlob) return;
            
            const url = URL.createObjectURL(currentAudioBlob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `unicorn-orator-${Date.now()}.wav`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            
            showStatus('Audio downloaded successfully!', 'success');
        }

        async function shareAudio() {
            try {
                const url = window.location.href;
                await navigator.clipboard.writeText(url);
                showStatus('URL copied to clipboard!', 'success');
            } catch (error) {
                showStatus('Failed to copy URL to clipboard', 'error');
            }
        }

        function showStatus(message, type) {
            statusMessage.textContent = message;
            statusMessage.className = `mt-6 p-4 rounded-lg ${
                type === 'success' ? 'bg-green-500/20 text-green-200 border border-green-500/30' :
                type === 'error' ? 'bg-red-500/20 text-red-200 border border-red-500/30' :
                'bg-blue-500/20 text-blue-200 border border-blue-500/30'
            }`;
            statusMessage.classList.remove('hidden');
            
            // Auto-hide success messages
            if (type === 'success') {
                setTimeout(hideStatus, 3000);
            }
        }

        function hideStatus() {
            statusMessage.classList.add('hidden');
        }

        function toggleSettings() {
            const panel = document.getElementById('settingsPanel');
            const toggle = document.getElementById('settingsToggle');
            if (panel.classList.contains('hidden')) {
                panel.classList.remove('hidden');
                toggle.textContent = '▲';
            } else {
                panel.classList.add('hidden');
                toggle.textContent = '▼';
            }
        }

        function updateEmotionValue() {
            const value = parseFloat(emotionSlider.value);
            if (value < 0.5) {
                emotionValue.textContent = 'Neutral';
            } else if (value < 1.5) {
                emotionValue.textContent = 'Normal';
            } else {
                emotionValue.textContent = 'Expressive';
            }
        }

        function updatePitchValue() {
            const value = parseFloat(pitchSlider.value);
            pitchValue.textContent = value > 0 ? `+${value} st` : `${value} st`;
        }
        
        function setTheme(theme) {
            const body = document.body;
            const themeButtons = document.querySelectorAll('.theme-btn');
            
            // Remove all theme classes
            body.classList.remove('theme-light', 'theme-dark', 'theme-magic');
            
            // Add new theme class
            body.classList.add(`theme-${theme}`);
            
            // Update theme-specific styles
            if (theme === 'light') {
                body.classList.remove('bg-gradient-to-br', 'from-purple-900', 'via-blue-900', 'to-indigo-900', 'text-white');
                body.classList.add('bg-gray-50');
                // Update header styles
                document.querySelectorAll('.gradient-text').forEach(el => {
                    el.classList.add('text-gray-900');
                });
                document.querySelectorAll('.text-purple-200, .text-purple-300').forEach(el => {
                    el.classList.add('text-gray-600');
                });
            } else if (theme === 'dark') {
                body.classList.remove('bg-gradient-to-br', 'from-purple-900', 'via-blue-900', 'to-indigo-900');
                body.classList.add('bg-gray-900', 'text-gray-100');
                // Update header styles
                document.querySelectorAll('.gradient-text').forEach(el => {
                    el.classList.add('text-gray-100');
                });
                document.querySelectorAll('.text-purple-200, .text-purple-300').forEach(el => {
                    el.classList.add('text-gray-400');
                });
            } else {
                // Magic theme - restore original classes
                body.classList.add('bg-gradient-to-br', 'from-purple-900', 'via-blue-900', 'to-indigo-900', 'text-white');
                document.querySelectorAll('.gradient-text').forEach(el => {
                    el.classList.remove('text-gray-900', 'text-gray-100');
                });
                document.querySelectorAll('.text-purple-200, .text-purple-300').forEach(el => {
                    el.classList.remove('text-gray-600', 'text-gray-400');
                });
            }
            
            // Save theme preference
            localStorage.setItem('unicorn-orator-theme', theme);
            
            // Update active button state
            themeButtons.forEach(btn => {
                btn.classList.remove('bg-white/30');
            });
            event.target.closest('.theme-btn')?.classList.add('bg-white/30');
        }

        // Keyboard shortcuts
        document.addEventListener('keydown', function(e) {
            if (e.ctrlKey || e.metaKey) {
                switch(e.key) {
                    case 'Enter':
                        e.preventDefault();
                        if (!generateBtn.disabled) {
                            generateSpeech();
                        }
                        break;
                    case 'k':
                        e.preventDefault();
                        clearText();
                        break;
                }
            }
        });
    </script>
</body>
</html>